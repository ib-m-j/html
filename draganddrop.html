
<!DOCTYPE HTML>
<html>
<head>
<style>
#table {width:100%; padding:2px; font-size:3em; border-spacing:10px;}
#other {position:absolute; top:300px; width:20px;height:20px;padding:10px;border:1px solid #aaaaaa;}
#namelist {list-style-type:none; height:275px; padding:10px; 
           margin:0px; white-space:nowrap; overflow:hidden; 
           overflow-x:auto; border:solid red 2px;}
#table div {background-color:lightgrey; padding:3px;}
#table td { margin:5px;}
.dropzone {height:150px; background-color:"#555555"; text-align:center; 
           border:solid black 1px; padding-left:10px; padding-right:10px;}
.unseatedPlayer {height: 120px; font-size:2.5em;   
           background-color:lightgrey; border-radius:10px; 
           padding-left:5px; min-width: 100px;  
           padding-right:5px; margin:10px; 
           display:inline-block; text-align:center; 
           line-height:120px;}
.seat {border:solid black 1px; border-radius:10px; width: 
       calc((100% - 9em;) / 2); font-size:1.5em; 
        block-sizing:border-box; padding-left: 5px; padding-top:5px;
        text-overflow:clip; overflow:hidden; height:5em;}
 .seatdata {font-size:2.2em; margin: 0.2em auto o.2em; text-align:center; 
            white-space:nowrap; text-overflow:clip; overflow:hidden;}
    .no-overflow {
        display:inline-block;
        white-space:nowrap;
        position:relative; /* must be relative */
        width:100%; /* fit to table cell width */
        margin-right:-1000px; /* technically this is a less than zero width object */
        overflow:hidden;}
</style>
<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
<script src="http://code.jquery.com/ui/1.8.21/jquery-ui.min.js"></script>
<script>

var droppedBgColor = "#cccccc";
var dropzoneBgColor = "#555555";
var openColor = "white"
var dropName = "";
var dropElements = [];
var currentNo = 100;

$(document).ready(function(){
  setStatus("document ready");
  $(".unseatedPlayer").on({
      'touchstart': function(ev) {var e = ev.originalEvent; touchStart(e);},
      'touchmove': function(ev) {var e = ev.originalEvent; touchMove(e);},
      'touchend': function(ev){var e = ev.originalEvent; touchEnd(e); }
     });

  $(".seat").on({
      'touchstart': function(ev) {var e = ev.originalEvent; touchSeatStart(e);},
//reusing seatMove
      'touchmove': function(ev) {var e = ev.originalEvent; touchMove(e);}, 
      'touchend': function(ev){var e = ev.originalEvent; touchSeatEnd(e); }
     });

  $(".dropzone").on(
      'touchstart', function(ev) {var e = ev.originalEvent; setToBottom(e);});


});

// helper functions 1111111111111111111111111111111111111111111
function setStatus(x) {
document.getElementById("status").innerHTML= x;
}

function addStatus(x) {
document.getElementById("status").innerHTML= document.getElementById("status").innerHTML + "<br>" + x;
}

function getSeatPair(el) {
    var parent;
    var child;
    if (el.className == "seat") {
      parent = el;
      child = $("#"+el.id).find("div")[0];
    }
    else if (el.className =="seatdata") {
      child = el; 
      parent = el.parentNode;
    }
    else {
       return [];
    } 
    return ([parent, child]);
}


// event handling 2222222222222222222222222222222222222222222

function touchStart(event) {
  var touch = event.changedTouches[0];
  if (touch.target.id != "listadder") {
      event.preventDefault();
      dropName = touch.target.id;
      setStatus("Starting with touch" + dropName);
      touch.target.style.backgroundColor = openColor;
  }
}

function touchSeatStart(event) {
  var touch = event.changedTouches[0];
  var parent;
  var child;
  parent = getSeatPair(touch.target)[0];
  child = getSeatPair(touch.target)[1];
  setStatus("Seat start");
  addStatus(child.innerHTML.trim().length);
  addStatus(dropElements.length);
  if (child.innerHTML.trim().length > 0) {
  addStatus("starting drag");
      event.preventDefault();
      dropElements = [parent,child];
      parent.style.backgroundColor = openColor;
}
}
function touchMove(event) {
  event.preventDefault();
}

function dropTouch(from, toParent, toChild) {
  toChild.innerHTML = from.innerHTML;
  toParent.style.backgroundColor = droppedBgColor;
  $('#'+from.id).detach();
//  from.style.backgroundColor="white";
  dropName = "";
}

function touchEnd(event) {
    event.preventDefault();
    var touch = event.changedTouches[0];
    setStatus("starting tounch end ");
    var el = document.elementFromPoint(touch.clientX, touch.clientY);
    setStatus("fandt element" + el.id);
    var returnValue;
    var dragToPair = getSeatPair(el);
//    if (el.className == "seat") {
//      var children = $("#"+el.id).find("div");
//      addStatus("nu her i seat" + children[0].className);
//      returnValue = [el, children[0]];
//    }
//    else if (el.className =="seatdata") {
//      addStatus("nu her");
//      returnValue = [el.parentNode, el];
//    }
//    else {
//    returnValue = "";
//    }
//    addStatus("returnValue " + returnValue);      		  
  
      if (dragToPair.length == 2 && 
              dragToPair[1].innerHTML.trim() == "") {
         var from =  document.getElementById(dropName);
         dragToPair[1].innerHTML = from.innerHTML;
         dragToPair[0].style.backgroundColor = droppedBgColor;
         $('#'+from.id).detach();
         dropName = "";
    } 
    else {
      document.getElementById(dropName).style.backgroundColor = droppedBgColor;
      dropName = "";
    }
}

function touchSeatEnd(event) {
    event.preventDefault();
    var touch = event.changedTouches[0];
    var el = document.elementFromPoint(touch.clientX, touch.clientY);
    var dragToPair = getSeatPair(el);
    setStatus(dropElements);
    addStatus(dropElements.length);
    if (el.id == "namelist" && dropElements.length !=0) {
        setStatus("starting insert");
        addStatus(dropElements[1].innerHTML);
        var name = dropElements[1].innerHTML;
        addStatus('id="name' + currentNo + '" class="unseatedPlayer">' + name);
        $('#namelist').prepend(
          '<li id="name'+currentNo+'" class="unseatedPlayer">'+ name+'</li>');
      $("#name"+currentNo).on({
      'touchstart': function(ev) {var e = ev.originalEvent; touchStart(e);},
      'touchmove': function(ev) {var e = ev.originalEvent; touchMove(e);},
      'touchend': function(ev){var e = ev.originalEvent; touchEnd(e); }
     });
        dropElements[1].innerHTML = "";
        currentNo += currentNo;
        dropElements = [];
     } 
     else if (dragToPair.length == 2 && 
              dragToPair[1].innerHTML.trim() == "") {
         dragToPair[0].style.backgroundColor = droppedBgColor; 
         dragToPair[1].innerHTML = dropElements[1].innerHTML;
         dropElements[0].style.backgroundColor = openColor;
         dropElements[1].innerHTML = "";
         dropElements = [];
        }
     else {
        dropElements[0].style.backgroundColor = droppedBgColor;
        dropElements = [];
     }
}


function setToBottom(ev) {
  event.preventDefault();
  var touch = event.changedTouches[0];
  var oldTexts = new Array;
  var newTexts = new Array;
  var ids = ["Nord", "Øst", "Syd", "Vest"];
  
  var bottomId = ids.indexOf(document.getElementById(touch.target.id));

  for (i = 0; i < ids.length; i++) {  
     oldTexts[i] = document.getElementById([ids[i]]).innerHTML;
  };

  for (i = 0; i < ids.length; i++) {
     newTexts[(i + bottomId) % 4] =  oldTexts[i];
  };

  for (i = 0; i < ids.length; i++) {  
     document.getElementById([ids[i]]).innerHTML = newTexts[i];
  };
}



function setdirs(target) {
var texts = ["aa","bb","cc"];
var dirs = ["North", "East", "South", "West"]
var res = "";
var start = Number(target[target.length - 1]);
//window.alert(start+" "+((start+0)%4));
for (i=0;i<4;i++) {
document.getElementById("plads"+((start+i)%4)).innerHTML = dirs[i] + document.getElementById("plads"+((start+i)%4)).innerHTML ;
//window.alert("plads"+((start+i)%4)+"  "+i+" "+start+" "+(start+i));
}
}
</script>
</head>
<body >
<p style="font-size:2em;">
Træk først navne hen på pladserne. Ved fejl træk tilbage til listen. Tilføj navne - klik på '+++'.
<div  style="width:100%; position:relative; top:0px; left:0px; ">
<ul id="namelist" >
<li id="name1" class="unseatedPlayer">Einar</li>
<li id="name2" class="unseatedPlayer">Guddie</li>
<li id="name3" class="unseatedPlayer">Philippe</li>
<li id="name4" class="unseatedPlayer">Ib</li>
<li id="name5" class="unseatedPlayer">Bente</li>
<li id="name6" class="unseatedPlayer">longerme6</li>
<li id="name7" class="unseatedPlayer">very long longername7</li>
<div id="listadder" class="unseatedPlayer"
     style="font-weight:bold; position:absolute; 
            bottom:8px; left:12px;" >+++</div>
</ul>
</div>


<div style="position:relative; top:50px; left:0px;">
<div id="plads1" class="seat" style="margin:0 auto;">Nord
  <div class="seatdata" ></div>
</div>

	    
<div style="display:table; padding: 8px; width:100%;  table-layout:fixed;
       white-space:nowrap; overflow:hidden; overflow-x:auto;">
   <div style="display:table-row; height:7em;">
     <div id="plads4" class="seat" 
	  style="display:table-cell;">Vest
       <div class="seatdata"></div>
     </div>
     
     <div id="space" 
	  style="display:table-cell; width:7em; margin: 5px auto;  
		 block-sizing:border-box;" >
     </div>

     <div  id="plads3" class="seat" 
	   style="display:table-cell; ">Øst
       <div class="seatdata"></div>
     </div>

   </div>
</div>

<div id="plads2" class="seat" style="margin: 5px auto;">Syd
  <div class="seatdata"></div>
</div>


<div id="status" style="font-size:2em; width:300px; 
height:200px; background-color:lightgreen; display:inline-block;" >
</div>
<div id="status1" style="font-size:2em; width:300px; height:200px; background-color:lightgreen; display:inline-block; float:right;" >
</div>
</div>
</body>
</html>
